#!/bin/bash
#
# Gets the current status of the module (git)

. $HOME/.tixrc

### if no arguments, throw an error
if [ $# -eq 0 ]; then
  >&2 echo "${RED}--Must specify a module to check status for...--${NC}"
  exit 1
fi

module_name=$1
module_dir=${2-$module_name}
module_root="$MODULE_ROOT/$module_dir"
module_url="$GITHUB_URL_TIX/$module_name"


### if module not cloned, throw an error
if [ ! -d $module_root ]; then
  >&2 echo -e "${RED}--Module $module_name does not exist at $module_root...--${NC}"
  exit 1
fi

pushd $module_root >/dev/null
  status=$(git status 2>&1)
  count=$(echo $status | tr '\n' ' ' | sed -e 's/[^0-9]/ /g' -e 's/^ *//g' -e 's/ *$//g' | tr -s ' ' | sed 's/ /\n/g')
  case "$status" in
    *modified*)
      modified_count=$(echo $status | grep modified | wc -l)
      >&2 echo -e "${RED}Module $module_name has $modified_count dirty files.${NC}"
      ;;
    *ahead*)
      >&2 echo -e "${PURPLE}Module $module_name is clean but is ahead of origin by $count commits.${NC}"
      ;;
    *)
      >&2 echo -e "Module $module_name is clean."
      ;;
  esac
popd >/dev/null