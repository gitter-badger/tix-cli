#!/bin/bash
#
# Syncs an exact revision of a module to the sync directory.

set -e

. "$HOME/.tixrc"

### if no arguments, throw an error
if [ $# -lt 2 ]; then
  >&2 printf -- "%b- must specify module to clone and revision... -%b" "$RED" "$NC"
  exit 1
fi

module_name="$1"
revision="$2"

module_sync_root="$SYNC_ROOT/$module_name"

if [ ! -d "$module_sync_root" ] ; then
  >&2 printf -- "${CYAN}--Module does not exist in sync directory, cloning...--${NC}"
  mkdirp "$SYNC_ROOT"
  clone-module -s "$module_name"
  >&2 printf -- "--Finished cloning module to sync directory--"
fi

pushd "$module_sync_root">/dev/null
  >&2 printf -- "- fetching and force revision checkout -"
  git fetch --all
  >&2 printf -- "- issuing \"git checkout --force %s \" -" "$revision"
  git checkout --force "$revision"
  >&2 printf -- "- finished fetch and revision checkout -"
popd >/dev/null
