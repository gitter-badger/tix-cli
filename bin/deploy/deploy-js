#!/bin/bash
#
# Deploys fresh tixinc-js artifacts

set -e

### if no arguments, throw an error
if [ $# -lt 1 ]; then
  >&2 echo -e "${RED}--Must specify a revision to deploy...--${NC}"
  exit 1
fi

. $HOME/.tixrc

revision="$1"

>&2 echo "--Cleaning artifacts--"
rimraf "$JS_ARTIFACTS_ROOT"

echo "--executing build-js $revision--"
build-js "$revision"

>&2 echo "--Copying artifacts revision $revision--"
pushd $JS_BUILD_ROOT >/dev/null
  mkdirp "$JS_ARTIFACTS_ROOT"
  cp -rf ./ "$JS_ARTIFACTS_ROOT"
popd >/dev/null

>&2 echo "--Building artifacts revision $revision--"
pushd $JS_ARTIFACTS_ROOT >/dev/null
  rimraf .git
  npm install --production
  >&2 echo "--downloading 64 bit node.exe to bin--"
  curl -sL http://nodejs.org/dist/v0.12.4/x64/node.exe >bin/node.exe
popd >/dev/null

>&2 echo -e "${GREEN}--Artifacts revision $revision successfully deployed--${NC}"
