#!/bin/bash
#
# Deploys fresh tixinc-js artifacts

set -e

### if no arguments, throw an error
if [ $# -lt 1 ]; then
  >&2 echo "Must specify a revision to deploy..."
  exit 1
fi

. $HOME/.tixrc

revision=$1

>&2 echo "--Cleaning artifacts--"
rimraf "$JS_ARTIFACTS_ROOT"

build-js $revision

>&2 echo "--Copying artifacts revision $revision--"
pushd $JS_BUILD_ROOT >/dev/null
  mkdirp "$JS_ARTIFACTS_ROOT"
  cp -rf ./ "$JS_ARTIFACTS_ROOT"
popd >/dev/null

>&2 echo "--Building artifacts revision $revision--"
pushd $JS_ARTIFACTS_ROOT >/dev/null
  rimraf .git
  npm install
popd >/dev/null

>&2 echo "--Artifacts revision $revision successfully deployed--"
