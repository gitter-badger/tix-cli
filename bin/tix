#!/bin/bash
#
# This script prepares the tix-cli dependencies and starts it.

set -e
OPTIND=1

source $HOME/local/bin/node_modules/tix-cli/bin/tix-init

### Get tokens / auth
GITHUB_TOKEN=$(github-token)
npm-token

### Mandatory install
if [ ! -e $CLI_PATH ]; then
  ### NPM Packages
  ### rimraf: Short for "rm -rf", advanced file / directory removal
  if hash sudo 2>/dev/null; then
    sudo npm install -g rimraf
  else
    npm install -g rimraf
  fi
  install-cli
fi

### Command line flags
while getopts "ocx" opt; do
    case "$opt" in
    o) ### Install optional files
      install-optional
      ;;
    c) ### Clean install directories
      echo "Cleaning previous installation..."
      rimraf $CONFIG_PATH
      rimraf $NPMRC_PATH
      rimraf $CLI_ROOT
      echo "Cleaning complete."
      ;;
    x)
      pushd $CLI_ROOT
        npm install @tixinc/automation --save
      popd
      ;;
    \?)
      exit 1
      ;;
    esac
done




echo "Executing CLI at $CLI_PATH..."
node "${CLI_PATH}"