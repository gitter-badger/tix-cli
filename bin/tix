#!/bin/bash
#
# This script prepares the tix-cli dependencies and starts it.

set -e
OPTIND=1

#PATHs
readonly INSTALL_ROOT=$HOME
readonly NPMRC_PATH="${HOME}/.npmrc"
readonly CONFIG_PATH="${INSTALL_ROOT}/.tixrc"

readonly MODULE_ROOT="${INSTALL_ROOT}/tixinc"
readonly CLI_ROOT="${MODULE_ROOT}/tix-cli"
readonly CLI_PATH="${MODULE_ROOT}/tix-cli/tix-cli.js"

while getopts "c" opt; do
    case "$opt" in
    c)
        echo "Cleaning previous installation..."
        npm install -g rimraf
        rimraf $CONFIG_PATH
        rimraf $NPMRC_PATH
        rimraf $CLI_ROOT
        echo "Cleaning complete."
        ;;
    \?)
        exit 1
        ;;
    esac
done

npm-authenticate
GITHUB_TOKEN=$(github-token)

if [ ! -e $CLI_PATH ]; then
  install-cli
fi

echo "Executing CLI at $CLI_PATH..."
node "${CLI_PATH}"